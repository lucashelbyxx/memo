**观察者**是一种行为设计模式， 允许一个对象将其状态的改变通知其他对象

观察者模式提供了一种作用于任何实现了订阅者接口的对象的机制， 可对其事件进行订阅和取消订阅。

值得关注的状态的对象通常被称为*目标*， 由于它要将自身的状态改变通知给其他对象， 我们也将其称为*发布者* （pub­lish­er）。 所有希望关注发布者状态变化的其他对象被称为*订阅者* （sub­scribers）。

观察者模式建议你为发布者类添加订阅机制， 让每个对象都能订阅或取消订阅发布者事件流。  该机制包括 1） 一个用于存储订阅者对象引用的列表成员变量； 2） 几个用于添加或删除该列表中订阅者的公有方法。



```java
// publisher
// publisher/EventManager.java:基础发布者
public class EventManager {
    // 维护了一个事件类型、订阅者列表的 HashMap
    Map<String, List<EventListener>> listeners = new HashMap<>();
    
    //String... 可变长度参数列表
    public void EventManager(String... operations) {
        for (operation : operations) {
            this.listeners.put(operation, new ArrayList<>());
        }
    }
    
    //添加订阅者，根据事件类型找到订阅者列表添加
    public void subscribe(String eventType, EventListener listener) {
        List<EventListener> users = listeners.get(eventType);
        users.add(listener);
    }
    
    public void unsubscribe(String eventType, EventListener listener) {
        List<EventListener> users = listeners.get(eventType);
        users.remove(listener);
    }
    
    //通知订阅者做出反应，找到对应的订阅者列表，遍历
    public void notify(String eventType, File file) {
        List<EventListener> users = listeners.get(eventType);
        for(EventListener listener : users) {
            listener.update(eventType, file);
        }
    }
}


// editor：具体发布者，有其他对象追踪
public class Editor{
    public EventManager events;
    private File file;
    
    public void Editor() {
        event = new EventManager("open", "save") ;
    }
    
    public void openFile(String filePath) {
        file = new File(filePath);
        events.notify("open", file);
    }
    
    public void saveFile() throws Exception {
        if (file != null) {
            events.notify("save", file);
        } else {
            throw new Exception("Open a file first.")
        }
    }
}


// listeners
// EventListener.java:通用观察者接口
public interface Eventlistener {
    void update(String eventType, File file);
}

// listeners/EmailNotificationListener.java:收到邮件通知后发送邮件
public class EmailNotificationListener implements Eventlistener {
    private String email;

    public EmailNotificationListener(String email) {
        email = email;
    }

    @Override
    public void update(String eventType, File file) {
        System.out.println("Save to log " + log + ": Someone has performed " + eventType + " operation with the following file: " + file.getName());
    }
}

// listener/LogOpenListener.java:收到通知后在日志记录一天信息
public class LogOpenListener implements EventListener {
    private File log;

    public LogOpenListener(String fileName) {
        this.log = new File(fileName);
    }

    @Override
    public void update(String eventType, File file) {
        System.out.println("Save to log " + log + ": Someone has performed " + eventType + " operation with the following file: " + file.getName());
    }
}


public class Demo {
    public static void main(String[] args) {
        Editor editor = new Editor();
        editor.events.subscribe("open", new LogOpenListener("file.txt"));
        editor.events.subscribe("save", new EmailNotificationListener("xxx@gmail.com"));

        try {
            editor.openFile("test.txt");
            editor.saveFile();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

